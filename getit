#! /bin/sh
#
#

healpytag="1.5.0"
githealpy=0 # 1: uses GIT, 0: uses tar.gz
healpixbranch="trunk"
#healpixbranch="branches/branch_v300r365"
#
healpyrepo="https://github.com/healpy/healpy.git"
healpyarchive="https://github.com/healpy/healpy/archive/"
healpixrepo="svn://svn.code.sf.net/p/healpix/code/" # read-only
#healpixrepo="https://healpix.svn.sourceforge.net/svnroot/healpix/"
#
WRKDIR="/tmp"
#
current=`grep -v '#' ./Version`
version=${current}
printf "Enter version number ($current) "
read answer
[ "x$answer" != "x" ] && version="$answer"
VERSION=$version

echo "Version: ${VERSION}    in ${WRKDIR}"
echo "healpy:   ${healpyrepo}   ${healpytag}"
echo "healpix:  ${healpixrepo}${healpixbranch}"
printf "Do you want to proceed (y/n) [n]: "
read answer
doit=0
[ "x$answer" = "xy" ] && doit=1

if [ ${doit} = 1 ] ; then
    cd ${WRKDIR}

    \rm -rf             ${WRKDIR}/Healpix_${VERSION}
    \rm -rf             ${WRKDIR}/healpy

    cd ${WRKDIR}
    svn co    ${healpixrepo}${healpixbranch} Healpix_${VERSION}

    if [ ${githealpy} = 1 ] ; then
	git clone ${healpyrepo}  healpy 
	cd healpy 
	git checkout ${healpytag} 
	git branch
    else
	wget ${healpyarchive}${healpytag}.tar.gz -O healpy-${healpytag}.tar.gz
	tar -xvzpf healpy-${healpytag}.tar.gz
	mv healpy-${healpytag} healpy
    fi


    cd ${WRKDIR}
    cp -pr healpy Healpix_${VERSION}/src
    cd Healpix_${VERSION}/src/healpy

#     \rm -rf hpbeta .git* 
#     ln -s ../cxx hpbeta 
    \rm -rf healpixcxx .git*
    mkdir -p healpixcxx/src
    cd healpixcxx/src
    ln -s ../../../cxx .

    cd ${WRKDIR}
fi

exit

