<?xml version="1.0"?>
<project name="HEALPix build file" default="all" basedir=".">
  <property name="lib" value="${basedir}/lib"/>
  <property name="classes" value="${basedir}/classes"/>
  <property name="dist" value="${basedir}/dist"/>
  <property name="src" value="${basedir}/src"/>
  <property name="docs" value="${basedir}/doc"/>
  <property name="junit.reports" value="${basedir}/reports/junit"/>
  <path id="classpath">
    <pathelement location="${classes}"/>
    <fileset dir="${lib}">
      <include name="*.jar"/>
    </fileset>
  </path>
  <target name="init" description="Initialize the build">
    <mkdir dir="${classes}"/>
    <mkdir dir="${dist}"/>
    <mkdir dir="${docs}"/>
  </target>
  <target name="clean" depends="" description="Clean the build">
    <delete dir="${classes}"/>
    <delete dir="${junit.reports}"/>
    <delete dir="${docs}"/>
  </target>
  <target name="compile" depends="init" description="Compile the new Java code">
    <echo>building </echo>
    <javac destdir="${classes}" source="1.5" includeAntRuntime="false"
      srcdir="${src}" >
      <classpath refid="classpath" />
    </javac>
  </target>
  <target name="test" depends="compile" description="Test the new Java code">
    <delete dir="${junit.reports}"/>
    <mkdir dir="${junit.reports}"/>
    <junit errorProperty="junit.failed" failureProperty="junit.failed" fork="yes"
      maxmemory="1g" printsummary="withOutAndErr" showoutput="yes">
      <classpath refid="classpath" />
      <formatter type="xml" usefile="true" />
      <batchtest todir="${junit.reports}">
        <fileset dir="${classes}" includes="**/test/*Test.class" />
      </batchtest>
    </junit>
    <junitreport todir="${junit.reports}">
      <fileset dir="${junit.reports}">
        <include name="TEST-*.xml"/>
      </fileset>
      <report format="frames" todir="${junit.reports}/html"/>
    </junitreport>
    <fail message="Test Cases Failed" if="junit.failed"/>
  </target>
  <target name="dist" depends="clean,compile,test" description="Build the JAR file containing only new classes">
    <jar destfile="${dist}/jhealpixNew.jar">
      <fileset dir="${classes}" excludes="**/test/*Test.class" />
    </jar>
  </target>
  <target name="distsrc" depends="clean" description="Build the source JAR file containing only new classes">
    <jar destfile="${dist}/jhealpixNew_src.jar">
      <fileset dir="${src}" />
    </jar>
  </target>
  <target name="docs" description="Create the Javadocs">
    <javadoc destdir="${docs}" failonerror="true" use="true"
      additionalparam='-breakiterator -public -quiet -tag copyright:a:"Copyright:" -link http://java.sun.com/j2se/1.5.0/docs/api -link http://download.java.net/media/java3d/javadoc/1.4.0'
      classpathref="classpath">
      <packageset dir="${src}" defaultexcludes="yes">
        <exclude name="**/test/**" />
      </packageset>
<!--      <footer>"Built from revision ${svn.revision}"</footer> -->
    </javadoc>
  </target>
  <target name="all" depends="dist,distsrc,docs" description="Do everything for the new library"/>
</project>
